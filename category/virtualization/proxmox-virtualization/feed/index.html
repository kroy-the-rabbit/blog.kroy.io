<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
	xmlns:georss="http://www.georss.org/georss"
	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
	>

<channel>
	<title>Proxmox &#8211; blog.kroy.io</title>
	<atom:link href="https://blog.kroy.io/category/virtualization/proxmox-virtualization/feed/" rel="self" type="application/rss+xml" />
	<link>https://blog.kroy.io/</link>
	<description>computers, tech, and whatever other random stuff crosses my mind.</description>
	<lastBuildDate>Mon, 07 Dec 2020 15:37:35 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.8</generator>

<image>
	<url>https://blog.kroy.io/wp-content/uploads/2020/04/cropped-android-chrome-512x512-3-32x32.png</url>
	<title>Proxmox &#8211; blog.kroy.io</title>
	<link>https://blog.kroy.io/</link>
	<width>32</width>
	<height>32</height>
</image> 
<site xmlns="com-wordpress:feed-additions:1">166765678</site>	<item>
		<title>The Great Rack Migration &#8211; D1521</title>
		<link>https://blog.kroy.io/2019/10/07/the-great-rack-migration-d1521/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=the-great-rack-migration-d1521</link>
		
		<dc:creator><![CDATA[Kroy]]></dc:creator>
		<pubDate>Mon, 07 Oct 2019 16:43:37 +0000</pubDate>
				<category><![CDATA[ESXi]]></category>
		<category><![CDATA[Hardware]]></category>
		<category><![CDATA[HomeLab]]></category>
		<category><![CDATA[Proxmox]]></category>
		<category><![CDATA[Rack Migration]]></category>
		<category><![CDATA[Routing]]></category>
		<guid isPermaLink="false">https://blog.kroy.io/?p=352</guid>

					<description><![CDATA[As part of my continued rack migration, it was time to move the D1521. My Supermicro D-1521 host is my &#8220;whatever I need it to be&#8221; server. As I test&#8230;]]></description>
										<content:encoded><![CDATA[
<p>As part of my continued rack migration, it was time to move the D1521.</p>



<hr class="wp-block-separator"/>



<p>My Supermicro D-1521 host is my &#8220;whatever I need it to be&#8221; server.  As I test and lab different topics, it becomes a Proxmox host, ESXi host, KVM, router, etc.  Whatever I need it to be basically.  <br></p>



<p>Fortunately, this migration is just reusing parts from my <a href="https://blog.kroy.io/2017/03/13/whiteboxing-a-1u/">Whiteboxing a 1U series</a>. Which meant I had mostly already gone through the pain and had all parts on hand.</p>



<hr class="wp-block-separator"/>



<h2>The original home<br></h2>



<p>The &#8220;original&#8221; home for this server was a solid <a href="https://www.amazon.com/gp/product/B00DU6RVK8/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B00DU6RVK8&amp;linkCode=as2&amp;tag=blogkroyio10-20&amp;linkId=10d8e867e5c30bbd8e0c428b64f0b77a">Silverstone HTPC Case</a>. </p>



<figure class="wp-block-image"><img width="1024" height="768" src="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0301-1024x768.jpg" alt="" class="wp-image-353" srcset="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0301-1024x768.jpg 1024w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0301-300x225.jpg 300w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0301-768x576.jpg 768w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0301-850x637.jpg 850w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0301.jpg 1551w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>For a tiny case, the airflow is very decent, probably due to the huge fan that floats over the main board.  Though the PCIe slot needs a bit of extra love:</p>



<figure class="wp-block-image"><img width="1024" height="768" src="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0300-1024x768.jpg" alt="" class="wp-image-355" srcset="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0300-1024x768.jpg 1024w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0300-300x225.jpg 300w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0300-768x576.jpg 768w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0300-850x637.jpg 850w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0300.jpg 1551w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p></p>



<figure class="wp-block-image"><img width="1024" height="768" src="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0298-1024x768.jpg" alt="" class="wp-image-356" srcset="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0298-1024x768.jpg 1024w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0298-300x225.jpg 300w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0298-768x576.jpg 768w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0298-850x637.jpg 850w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0298.jpg 1551w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<hr class="wp-block-separator"/>



<h2>The final home</h2>



<p>I reused the old <a href="https://www.amazon.com/gp/product/B0093HNUD0/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B0093HNUD0&amp;linkCode=as2&amp;tag=blogkroyio10-20&amp;linkId=cff5dd63646471670d9f6ede771d735e&quot;>Supermicro Rack Mount Server Chassis CSE-505-203B</a><img src=&quot;//ir-na.amazon-adsystem.com/e/ir?t=blogkroyio10-20&amp;l=am2&amp;o=1&amp;a=B0093HNUD0">1U short depth Supermicro case</a> from my prior build.  </p>



<figure class="wp-block-image"><img width="1024" height="768" src="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0382-1024x768.jpg" alt="" class="wp-image-358" srcset="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0382-1024x768.jpg 1024w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0382-300x225.jpg 300w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0382-768x576.jpg 768w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0382-850x637.jpg 850w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0382.jpg 1551w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption>1u installed</figcaption></figure>



<p>And what it looks like when I&#8217;m in labbing mode and changing things around:</p>



<figure class="wp-block-image"><img width="1024" height="768" src="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0393-1024x768.jpg" alt="" class="wp-image-359" srcset="https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0393-1024x768.jpg 1024w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0393-300x225.jpg 300w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0393-768x576.jpg 768w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0393-850x637.jpg 850w, https://blog.kroy.io/wp-content/uploads/2019/10/IMG_0393.jpg 1551w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>You might notice some electrical tape holding down the fan.  The stock fan placement in this case is inefficient for these XeonD boards.  The fan ends up missing the CPU almost completely. </p>



<p>My original setup incorporated a lack rack, so the front facing I/O was okay.  In the rack setup, it&#8217;s just means I need an extra <a href="https://www.amazon.com/gp/product/B00BTRD4Y2/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B00BTRD4Y2&amp;linkCode=as2&amp;tag=blogkroyio10-20&amp;linkId=b41df4dd8754780fcfe06415aa30f631">1U brush panel</a>:</p>



<figure class="wp-block-image"><img width="662" height="149" src="https://blog.kroy.io/wp-content/uploads/2019/10/image-2.png" alt="" class="wp-image-357" srcset="https://blog.kroy.io/wp-content/uploads/2019/10/image-2.png 662w, https://blog.kroy.io/wp-content/uploads/2019/10/image-2-300x68.png 300w" sizes="(max-width: 662px) 100vw, 662px" /></figure>



<p>The final piece that I need to add was a <a href="https://amzn.to/2Ot30Gc">low-noise adapter</a> for the fan.  Considering the D1541 was going into a similar case, a three pack was good enough.</p>



<p>This server was by FAR the most loud thing in my rack, and even on optimal settings the fan was too loud.  With the adapter, it&#8217;s nice and cool (and silent):</p>



<figure class="wp-block-image"><img width="1024" height="69" src="https://blog.kroy.io/wp-content/uploads/2019/10/image-3-1024x69.png" alt="" class="wp-image-360" srcset="https://blog.kroy.io/wp-content/uploads/2019/10/image-3-1024x69.png 1024w, https://blog.kroy.io/wp-content/uploads/2019/10/image-3-300x20.png 300w, https://blog.kroy.io/wp-content/uploads/2019/10/image-3-768x52.png 768w, https://blog.kroy.io/wp-content/uploads/2019/10/image-3-850x58.png 850w, https://blog.kroy.io/wp-content/uploads/2019/10/image-3.png 1415w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>To be continued on <a href="/2019/10/07/the-great-rack-migration-d1541/">the D1541</a>.</p>
]]></content:encoded>
					
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">352</post-id>	</item>
		<item>
		<title>Migrating the lab BACK to ESXi after a Proxmox Experiment</title>
		<link>https://blog.kroy.io/2017/06/30/migrating-the-lab-back-to-esxi-after-a-proxmox-experiment/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=migrating-the-lab-back-to-esxi-after-a-proxmox-experiment</link>
		
		<dc:creator><![CDATA[Kroy]]></dc:creator>
		<pubDate>Sat, 01 Jul 2017 03:20:00 +0000</pubDate>
				<category><![CDATA[ESXi]]></category>
		<category><![CDATA[Proxmox]]></category>
		<category><![CDATA[Virtualization]]></category>
		<guid isPermaLink="false">https://blog2.kroy.io/2017/06/30/migrating-the-lab-back-to-esxi-after-a-proxmox-experiment/</guid>

					<description><![CDATA[A few months ago I migrated my home lab to Proxmox. After fighting with a few things, it&#8217;s time to move back to ESXi. It must have been about two&#8230;]]></description>
										<content:encoded><![CDATA[
<p>A few months ago I migrated my home lab to Proxmox.  After fighting with a few things, it&#8217;s time to move back to ESXi.</p>



<hr class="wp-block-separator"/>



<p>It must have been about two months ago that I decided I wanted to move away from ESXi.  My VMUG renewal is coming up, I wasn&#8217;t very happy with the bloated beast that vCenter has become, and I found I very much enjoyed Proxmox from my usage of it on the <a href="/tag/nucnucnuc/">NucNucNuc</a>.</p>



<h5 id="proxmox">Proxmox</h5>



<p>Here is a screenshot of my Proxmox cluster at its height.</p>



<figure class="wp-block-image"><img width="1024" height="849" src="https://blog2.kroy.io/wp-content/uploads/2019/08/S0QDasdfBy6-1024x849.png" alt="" class="wp-image-165" srcset="https://blog.kroy.io/wp-content/uploads/2019/08/S0QDasdfBy6-1024x849.png 1024w, https://blog.kroy.io/wp-content/uploads/2019/08/S0QDasdfBy6-300x249.png 300w, https://blog.kroy.io/wp-content/uploads/2019/08/S0QDasdfBy6-768x637.png 768w, https://blog.kroy.io/wp-content/uploads/2019/08/S0QDasdfBy6.png 1188w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>With the way that Proxmox clustering works, I was able to re-use an old AspireRevo R3700 (the acropolis) with a D525 Atom as a cluster witness.</p>



<p>For me, one of the best parts of Proxmox were Linux containers.  I had a few running, but in particular, my Plex container just felt so clean.  Instead of running a huge bloated OS, I just ran a simple little container.</p>



<h6 id="thedarkunderbellyofproxmox">The dark underbelly of Proxmox</h6>



<p>Unfortunately, things weren&#8217;t perfect.  The immediate issue that I noticed was that my cluster was using a solid 30% more electricity than the same servers, basic VMs, and setup under ESXi.  As I learned, Proxmox doesn&#8217;t do any power management, where ESXi does.  And while you can install cpufrequtils and setup governors, apparently it can very negatively impact VMs.</p>



<p>My Proxmox cluster ran a solid 342 watts.  Right now, the exact same hardware running under ESXi is at 303 watts.  11% is not an insignificant savings, especially when a focus of my lab has been to keep the power consumption lower.</p>



<h6 id="consolemyconsole">Console my console</h6>



<p>A <em>HUGE</em> negative for me was the console. I don&#8217;t use many Windows VMs, but the ones I do use need to work.  Coming from ESXi, the NoVNC/SPICE consoles in Proxmox is at best, a hack.  And finally, I didn&#8217;t want to mess with RDP.</p>



<p>Using VMWare Fusion, a console connection to a Windows VM almost feels native.  With SPICE, I ended up needing to reboot Windows often because it would act like the CONTROL key was held down. And a NoVNC connection to a Windows VM was just impossible to use as the mouse cursor was unpredictable and often unusable.</p>



<p>This poor console experience also translated elsewhere.  Proxmox doesn&#8217;t do well if you venture away from the official support list.  I wanted to play with Solaris and OpenIndiana, and at least under Proxmox, it was not really workable.  As I sometimes use &#8220;off the beaten path&#8221; software, this was difficult for me as well.</p>



<h5 id="badbadnetwork">Bad bad Network</h5>



<p>Proxmox also had another serious negative for me.  I <em>HATED</em> the networking.  I guess that&#8217;s the downside of coming from a polished system like ESXi, but in Proxmox it&#8217;s just uncomfortable.  I even set up Open vSwitch networking instead of Linux bridges, and while it was better, I only liked it slightly more.  Not to mention it appeared to have some issues when I started to subject it to serious load.</p>



<p>Any time I had to mess with any networking, touch any VLANs, etc, I just groaned.  I&#8217;ve got at least 25 years of Linux experience, so it&#8217;s not difficult.  It was just annoying.</p>



<p>There was also a bit of lag in almost all of my VMs that I was never able to attribute to anything.  All the networking was set up properly, access to the &#8220;datastores&#8221; was fast and reliable, and all the VMs had sufficient resource allocation.  Linux VMs ran slow and sluggish, and even with SPICE marginally working, Windows VMs were like clicking around in molasses.</p>



<h4 id="thefinalstraw">The final straw</h4>



<p>The quorum system is a bit of black magic to me.  In more advanced setups, best practice says you set up completely separate NICs, switches, etc to make sure that your cluster doesn&#8217;t lose quorum.  Because bad things happen.</p>



<p>Trust me, I found out.</p>



<p>The reality is, especially when you are using some NUCs and an Atom D525 net-top, it&#8217;s hard to set up &#8220;proper&#8221; redundancy.  I was forced to use a bunch of USB NICs to try and achieve acceptable levels of redundancy, which was tenuous at best.</p>



<p>I&#8217;ve got a box of these guys now:</p>



<figure class="wp-block-image"><img width="1024" height="768" src="https://blog2.kroy.io/wp-content/uploads/2019/08/IMG_0563-1024x768.jpg" alt="usb nics" class="wp-image-166" srcset="https://blog.kroy.io/wp-content/uploads/2019/08/IMG_0563-1024x768.jpg 1024w, https://blog.kroy.io/wp-content/uploads/2019/08/IMG_0563-300x225.jpg 300w, https://blog.kroy.io/wp-content/uploads/2019/08/IMG_0563-768x576.jpg 768w, https://blog.kroy.io/wp-content/uploads/2019/08/IMG_0563-1600x1200.jpg 1600w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>So what happens when 3/6 of your quorum members are on the other end of a 4x1Gbps LAG and the uplink gets saturated even for a second during a VM migration?  You lose quorum and bad things happen.</p>



<p>Let me just say.  This does NOT mean it is a broken system.  It just means it&#8217;s not working my <em>MY</em> setup.  More than anything, it just felt like a bunch of extra work to keep things running at acceptable levels.</p>



<p>With enterprise hardware and proper setup, I&#8217;m still planning a production Proxmox migration later this year.</p>



<h3 id="themigration">The Migration</h3>



<p>Migration between hypervisors is actually surprisingly easy, assuming you have multiple hosts where you can run the new hypervisor on one of them.</p>



<ul><li>Boot original VM with a Clonezilla ISO.</li><li>Create a VM on the new hypervisor.  Make the new drive 1 GB larger than the original.</li><li>Boot the new VM with the Clonezilla ISO.</li><li>Go through the process of cloning.  This involves going through a few menus on the original host and typing two commands on the new host in the command-line.</li><li>Shutdown old VM.</li><li>Install any drivers, change any network interface names, and install relevant guest agents (qemu_guest_agent/open_vm_tools).</li></ul>



<p>With a decent Ethernet connection between the servers, the whole cloning process of a VM really only takes a few minutes.</p>



<p>Even if you don&#8217;t have multiple servers, as long as you have some sort of networked or external storage, you can Clonezilla all your VMs to flat file images, install the new hypervisor, and then Clonezilla the VMs back from the disk images.</p>



<h5 id="helloesximyoldfriend">Hello ESXi my old friend</h5>



<p>I could never really get ESXi out of my system.  Even under Proxmox, I had setup a small virtualized ESXi cluster to play with things.  It&#8217;s just such a polished system, and it&#8217;s what my business uses.</p>



<p>After the split-brained quorum situation, I quickly made the decision to migrate back to ESXi fully.  With the Clonezilla solution outlined above, it took all of about two hours.</p>



<h3 id="theaftermath">The aftermath</h3>



<p>Unfortunately for the poor D525, the &#8220;acropolis&#8221;, that means it&#8217;s the end of the road.   This processor does not even support the VT-x required for virtualization.  Even under Proxmox, at the very best it could run a very light container or two.</p>



<p>I was excited to give this ancient hardware new life as a quorom witness, but with ESXi, there is no place for it.</p>



<p>The Acropolis stands alone, waiting for the quorom which will never return.</p>



<figure class="wp-block-image"><img width="1024" height="721" src="https://blog2.kroy.io/wp-content/uploads/2019/08/Screen-Shot-2017-05-29-at-4.25.12-PM-1024x721.png" alt="rip acropolis" class="wp-image-167" srcset="https://blog.kroy.io/wp-content/uploads/2019/08/Screen-Shot-2017-05-29-at-4.25.12-PM-1024x721.png 1024w, https://blog.kroy.io/wp-content/uploads/2019/08/Screen-Shot-2017-05-29-at-4.25.12-PM-300x211.png 300w, https://blog.kroy.io/wp-content/uploads/2019/08/Screen-Shot-2017-05-29-at-4.25.12-PM-768x541.png 768w, https://blog.kroy.io/wp-content/uploads/2019/08/Screen-Shot-2017-05-29-at-4.25.12-PM-1600x1127.png 1600w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>I haven&#8217;t had the heart to wipe it yet, so back on a shelf it went.</p>
]]></content:encoded>
					
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">23</post-id>	</item>
	</channel>
</rss>
