<!DOCTYPE html>
<html lang="en-US" itemscope itemtype="http://schema.org/Article"><head><meta charset="UTF-8"><title>vyos – blog.kroy.io</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="dns-prefetch" href="//s.w.org"><script type="text/javascript" data-cfasync="false">
    (window.gaDevIds=window.gaDevIds||[]).push("dNDMyYj");
	var em_version         = '6.3.0';
	var em_track_user      = true;
	var em_no_track_reason = '';
	
	var disableStr = 'ga-disable-UA-89722449-1';

	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}

	if ( 'undefined' === typeof gaOptout ) {
		function gaOptout() {
			__gaTrackerOptout();
		}
	}
	
	if ( em_track_user ) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

window.ga = __gaTracker;		__gaTracker('create', 'UA-89722449-1', 'auto');
		__gaTracker('set', 'forceSSL', true);
		__gaTracker('send','pageview');
		__gaTracker( function() { window.ga = __gaTracker; } );
	} else {
		console.log( "" );
		(function() {
			/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
			var noopfn = function() {
				return null;
			};
			var noopnullfn = function() {
				return null;
			};
			var Tracker = function() {
				return null;
			};
			var p = Tracker.prototype;
			p.get = noopfn;
			p.set = noopfn;
			p.send = noopfn;
			var __gaTracker = function() {
				var len = arguments.length;
				if ( len === 0 ) {
					return;
				}
				var f = arguments[len-1];
				if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
					console.log( 'Not running function __gaTracker(' + arguments[0] + " ....) because you are not being tracked. " + em_no_track_reason );
					return;
				}
				try {
					f.hitCallback();
				} catch (ex) {

				}
			};
			__gaTracker.create = function() {
				return new Tracker();
			};
			__gaTracker.getByName = noopnullfn;
			__gaTracker.getAll = function() {
				return [];
			};
			__gaTracker.remove = noopfn;
			window['__gaTracker'] = __gaTracker;
			window.ga = __gaTracker;		})();
		}
</script><style type="text/css" media="all">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style><link rel="stylesheet" id="wp-block-library-css" href="https://blog.kroy.io/wp-includes/css/dist/block-library/style.min.css" media="all"><style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style><link rel="stylesheet" id="wp-block-library-theme-css" href="https://blog.kroy.io/wp-includes/css/dist/block-library/theme.min.css" media="all"><link rel="stylesheet" id="wpautoterms_css-css" href="https://blog.kroy.io/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css" media="all"><link rel="stylesheet" id="SFSImainCss-css" href="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/css/sfsi-style.css" media="all"><link rel="stylesheet" id="disable_sfsi-css" href="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/css/disable_sfsi.css" media="all"><link rel="stylesheet" id="exactmetrics-popular-posts-style-css" href="https://blog.kroy.io/wp-content/plugins/google-analytics-dashboard-for-wp/assets/css/frontend.min.css" media="all"><link rel="stylesheet" id="sinatra-styles-css" href="https://blog.kroy.io/wp-content/themes/sinatra/assets/css/style.min.css" media="all"><link rel="stylesheet" id="sinatra-dynamic-styles-css" href="https://blog.kroy.io/wp-content/uploads/sinatra/dynamic-styles.css" media="all"><link rel="stylesheet" id="jetpack_css-css" href="https://blog.kroy.io/wp-content/plugins/jetpack/css/jetpack.css" media="all"><script src="https://blog.kroy.io/wp-includes/js/jquery/jquery.js" id="jquery-core-js"></script><script src="https://blog.kroy.io/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script><script id="wp-polyfill-js-after">
( 'fetch' in window ) || document.write( '<script src="https://blog.kroy.io/wp-includes/js/dist/vendor/wp-polyfill-fetch.min.js?ver=3.0.0">' + 'ipt>' );( document.contains ) || document.write( '<script src="https://blog.kroy.io/wp-includes/js/dist/vendor/wp-polyfill-node-contains.min.js?ver=3.42.0">' + 'ipt>' );( window.DOMRect ) || document.write( '<script src="https://blog.kroy.io/wp-includes/js/dist/vendor/wp-polyfill-dom-rect.min.js?ver=3.42.0">' + 'ipt>' );( window.URL && window.URL.prototype && window.URLSearchParams ) || document.write( '<script src="https://blog.kroy.io/wp-includes/js/dist/vendor/wp-polyfill-url.min.js?ver=3.6.4">' + 'ipt>' );( window.FormData && window.FormData.prototype.keys ) || document.write( '<script src="https://blog.kroy.io/wp-includes/js/dist/vendor/wp-polyfill-formdata.min.js?ver=3.0.12">' + 'ipt>' );( Element.prototype.matches && Element.prototype.closest ) || document.write( '<script src="https://blog.kroy.io/wp-includes/js/dist/vendor/wp-polyfill-element-closest.min.js?ver=2.0.2">' + 'ipt>' );
</script><script src="https://blog.kroy.io/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script><script src="https://blog.kroy.io/wp-content/plugins/auto-terms-of-service-and-privacy-policy/js/base.js" id="wpautoterms_base-js"></script><script id="exactmetrics-frontend-script-js-extra">
var exactmetrics_frontend = {"js_events_tracking":"true","download_extensions":"zip,mp3,mpeg,pdf,docx,pptx,xlsx,rar","inbound_paths":"[{\"path\":\"\\\/go\\\/\",\"label\":\"affiliate\"},{\"path\":\"\\\/recommend\\\/\",\"label\":\"affiliate\"}]","home_url":"https:\/\/PLACEHOLDER.wpsho","hash_tracking":"false"};
</script><script src="https://blog.kroy.io/wp-content/plugins/google-analytics-dashboard-for-wp/assets/js/frontend.min.js" id="exactmetrics-frontend-script-js"></script><script src="https://blog.kroy.io/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script><meta name="follow.it-verification-code-SERxZVdXbkRiWE9LYThHK2pmY09ydUlMSkF3cm9ERmJpV2JlS3p0Z1locmlNWjBFeGZtaFBCMEF4Q1hRblVqN0JUbGFXRXg4Y25yUnpVcFN0TUVQeTdIVUtkT1JVRXg2SXJvYndWbEJhRi9ZenJWdk1XSlc1VWQwQVIvNVY3dWJ8YnBDU2RZbGZvSzFjVlBLVDRjWGYwellwelNqT2ZCQzFzbmp6V24vN0FQOD0=" content="JYtCEsckN2zSqxbf9XAX"><meta name="viewport" content="width=device-width, initial-scale=1"><meta property="og:image:secure_url" content="https://blog.kroy.io/wp-content/uploads/2020/04/image-5.png" data-id="sfsi"><meta property="og:image:type" content="" data-id="sfsi"><meta property="og:image:width" content="336" data-id="sfsi"><meta property="og:image:height" content="135" data-id="sfsi"><meta property="og:url" content="https://blog.kroy.io/2020/05/04/vyos-from-scratch-edition-1/" data-id="sfsi"><meta property="og:description" content="




As a VyOS evangelist, maintainer, and more, I've been meaning to write a simple series of how-to guides for VyOS for a while.  Sure, there are plenty of guides out there, but I think a lot of them fall short in demonstrating WHY you are entering specific commands.  



VyOS is capable, but it's much more helpful if you can fully understand what it's doing.  



This initial guide will walk through the basic setup steps in replacing something like pfSense or some other consumer router with a simple and secure system running VyOS.  



This is also going to be a very very long post, so buckle in!













Who is this For



Anybody that wants to use VyOS of course!  



The nice thing about running VyOS is that if you set up it, and understand WHAT it's doing, then you've actually learned something about networking.  



Does something like pfSense work?  



Sure, but it also doesn't teach you much about what's actually going on.  And the knowledge learned in VyOS will easily translate to almost any other vendor like Cisco, Arista, and more.  At that point, the concepts are the same, you are just learning the different dialects. 







Environment



VyOS really doesn't take much in resources.  



8GB of storage and 2-4GB of RAM will be overkill for most basic setups.  



CPU-wise, even small Pentium Silver CPUs can handle gigabit and beyond, even over VPN .  Anything like an i3/i5 or a Xeon won't break a sweat except in all but the most demanding scenarios.



If you virtualize, it can be helpful to set up a test environment.  This could consist of a simple:



WAN Network.  For testing this could be your existing LAN network.A new LAN Network. For testing this could just be a separate port group or bridge, and it wouldn't even need an uplink.A simple VM with a GUI (or without), to run some testing. 



If virtualization isn't an option, VyOS can run on almost any device that is x86_64.  I've run it on everything from:



NUCs with single NICs and USB/USB-C NICs.WYSE 5070/3040 Thin Clients.A variety of Dells, including R710s/R620s/R630s.Anything Supermicro from 1U to 4U devices.



Finally, for this guide, I'll be working with two NICs.  



One is a WAN, connected to my current LAN.  I'll be creating a network inside a network.  The second will be our new LAN.  This is separate from my existing LAN so I can pretend like it's a second private network.  These interfaces can be anything:



Physical NICs.VLANs.Virtual NICs from ESXi, Proxmox, etc.







Install



The first step is to grab yourself a copy of the installer ISO.  



Most people will want the Rolling Release.  You can also build it yourself, via the Docker image, which is helpful if there are some extra packages you want to add.



If you want access to the LTS version, it requires self-building (an easy process), contributing, or a subscription. I highly recommend contributing, as even writing or cleaning up some documentation will get you access to the LTS prebuilt versions.  



You can also support and get access via Patreon or BuyMeACoffee.







Note that for these guides, I will be using a recent version of rolling.  This is important as some configuration nodes have changed locations and format between 1.3+ and the existing LTS versions (DHCP and IPv6 RAs are two things that come to mind).



[su_box title=Rolling Stability style=default box_color=#ddffdd title_color=#000000 radius=3 class= id=]
It's important to note that the rolling releases are generally completely stable.  I would say 95% of them or more are functional without any major bugs.

Every once in a while, some broken functionality is pushed, but it is almost always fixed quickly. A broken upgrade is not a show-stopper and it is trivial to boot back into the working version with the built-in Image Management.

I have no issues running rolling releases in many production locations.
[/su_box]



Install Steps



Installation is trivial:



Burn ISO to CD/DVD/USB stick, or boot ISO via remote management (iDrac, iLo, IPMI)Login with vyos/vyosType install imageAnswer the install stepsReboot and remove installation media



[su_box title=Installation Gotchas style=default box_color=#ffba00 title_color=#000000 radius=3 class= id=]


 The installer ISO is a fully functional VyOS image.  That means if you skip the install image step, you can configure the system, and it will work as intended... until you reboot.  Don't be me.  Make sure to install if you want a permanent installation.
 Some systems that lack a serial port get stuck on a black screen on the installer ISO.  The simple fix is to edit the grub boot option line and remove the console=ttyS0,115200 option from the kernel boot arguments.  Then just boot with CTRL-X as directed.

[/su_box]















Basic Configuration



Once installed, you'll be staring at the login screen.  Login with vyos and the password you set up during install:











Decision Time!



Before you go any further, you need to make a decision.  You need to pick out the subnet (or later subnets) where your network will live.  Or, if you are converting over your existing network, just reuse it.



These should be RFC1918 addresses.  You generally want a /24, which is 254 usable addresses.



So, there are three main groups of these private addresses you can choose from:



10.X.Y.1-254, where X and Y are any number between 0 and 255.  For the last number, 0 would be your network address, and 255 would be your broadcast address.  You could then assign all your hosts to 1-254.172.X.Y.1-254, in this case X would be between 16 and 31, and Y could be 0 to 255. 192.168.X.1-254, where X is between 0 and 255.  



[su_box title=Subnetting Pro-tips style=default box_color=#ddffdd title_color=#000000 radius=3 class= id=]
Many routers around the world off-the-shelf use a subnet like 10.0.0.0/24 or 192.168.0.0/24.

While you can use these subnets, future-you will hate yourself if you ever want to access your network remotely or access other networks when both sides are using the same subnet.


I would highly recommend:

 	Choose a subnet away from the norm.  For example, 10.32.47.0/24.
 	If you want to plan ahead and are planning to break things out on VLANs, use a subnet like 10.32.X.0/24.  That way, in the future, X can represent your VLAN number, and you can do a summary route like 10.32.0.0/16.  I'll be showing some examples of where this can be used later on in this post.

[/su_box]







Configuring the LAN and Remote access



After the subnet is chosen, the first step is to get the router on the LAN and accessible via SSH.  This makes it much easier to configure, as you are no longer tethered to a keyboard/monitor, VM console, can copy/paste, etc.  



LAN IP







Goals:



Enter configure modeAdd address to the correct interfaceCommit and save







The first step is to enter configure mode.  This allows you to make changes to the system configuration.  Type configure.  VyOS also supports shortcuts and tab completion, so typing conf or conf<TAB> will do the same thing.







The prompt will change to include #, and the [edit] line will appear to designate that you are in configure mode.



Next, you need to add your LAN IP.  You can check your interfaces by typing run show interfaces.  This tells VyOS to show all the interfaces in operational mode (the mode you were in before you typed conf).







In my case, eth1 is attached to my LAN here.  I'm going to use the subnet from above, 10.32.0.0/24.  I prefer to use .1 for my routers, but you can use any IP in that range.



There are two methods to assign it once in conf mode.  Either with the full path, or by drilling-down.



Full path:



configure
set interfaces ethernet eth1 address 10.32.0.1/24
set interfaces ethernet eth1 description LAN
commit
save



Drill down:



configure
edit interfaces ethernet eth1
set address 10.32.0.1/24
set description LAN
commit
save



Committing makes the configuration active, and saving saves it to disk so it will persist on a reboot.







Or:







You can show your work with show interfaces and run show interfaces







Set up DHCP



Now that that router has a LAN IP, it's time to connect your laptop/desktop/etc up to it.  



You can assign it a static IP in the chosen subnet (10.32.0.10/24 for example), but I imagine you are also going to want to assign a DHCP range for automatic configuration of clients.







Goals:



Enter configure modeSet up DHCP rangescommit and save







Let's talk about the following config.  



We are going to make two DHCP ranges, and leave some holes.  This would allow us to assign the IP addresses between .2 and .49 for static or other uses, as well as .126-199 and .251-254.



While this is a non-standard usage, it demonstrates the capabilities. Many people would just have a single range. 



set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 range 0 start 10.32.0.50
set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 range 0 stop 10.32.0.125
set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 range 1 start 10.32.0.200
set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 range 1 stop 10.32.0.250



Some other important config options follow.   



You want to tell the DHCP server to hand out the router's IP address as the default gateway and DNS.  This will make it so (eventually), your LAN devices will have DNS and routing to the Internet:



set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 dns-server 10.32.0.1
set service dhcp-server shared-network-name LAN subnet 10.32.0.0/24 default-router 10.32.0.1



[su_box title=DNS Alert style=default box_color=#ffdddd title_color=#000000 radius=3 class= id=]

This would also be the place to insert something like your pi-hole or active directory DNS server.  In the above example, your pi-hole/ADDNS address or addresses would be where the dns-server option is. 

[/su_box]



















SSH



The final step before we can access the router over SSH is to actually enable SSH:



set service ssh port 22
commit
save



At this point you ought to be able to hook up a LAN client, and verify that you have an IP, gateway, and DNS.  



This is a fairly stock Debian VM I set up.  As you can see, my IP is in one of my DHCP ranges, and my DNS and default route are the router's IP. 



This is on Linux, but the same thing could be confirmed on Windows or MacOS:







From there, you should be able to ssh into the router with the username vyos and password you set up during install:







And typing show configuration (in op mode), should show you the work done so far.  VyOS also comes with a few defaults, like NTP servers configured.











NAT & DNS



NAT



The next important duty for a router and firewall is to be able to NAT.  NAT allows all your private LAN devices to access the Internet.  



[su_box title=Information Dump style=default box_color=#ddffdd title_color=#000000 radius=3 class= id=]
Back when the Internet started, every device had a unique IP address. 

Unfortunately, because of the numbering scheme used, there are only 4.2 billion of these address, at least in IPv4, and the transition to IPv6 is far from complete.

Because of this, every device on your network needs to be able to pretend that it is your router to access the Internet.  Your router keeps track of which requests belong to which device.  

Source NAT is what allows you to do this.

This is also where the above mentioned summary route can come into play.  Instead of creating three separate NAT rules for 10.32.1.0/24, 10.32.2.0/24, and 10.32.3.0/24, you can create a single rule for 10.32.0.0/16.
[/su_box]



For this setup, it's important to identify which network interface will eventually be your WAN interface, even though it's not configured yet.







Goals:



As before, enter configuration mode.Set up a source NAT rule to target our LAN or LAN subnets.Define the outgoing WAN interface on the rule.Set the translation type of the rule to masquerade. 







The type of NAT we will be using is called SOURCE NAT.  This type of NAT is going to have three components:



Target all traffic from our LAN or LANs...... when the traffic is going out to the Internet through this outgoing interface...... Change the IP address from the LAN IP to the WAN IP



To do this:



set nat source rule 100 source address '10.32.0.0/24'
set nat source rule 100 outbound-interface 'eth0'
set nat source rule 100 translation address masquerade
commit
save



In the above example, the 100 is an arbitrary number (between 1-9999).  The eth0 is my eventual WAN interface.  masquerade translates the internal LAN IP to your public WAN IP.  











Once we set up our WAN interface, we'll be able to type show nat source rules in op mode, or run show nat source rules in conf mode to run the op mode command, it will be clear what's happening.







DNS



The next step is to set up our VyOS instance as for DNS.  This will allow you to use local DNS and caching instead of your ISP's, but also eventually will allow you run custom DNS and hosts. 







Goals:



Enter config modeSet the DNS Listen AddressSet the subnets we are allowing fromSet the cache size to 0commit and save







set service dns forwarding listen-address '10.32.0.1'
set service dns forwarding allow-from '10.32.0.0/24'
set service dns forwarding cache-size '0'
commit
save



As mentioned, this accomplishes three things.  



It tells VyOS to listen for DNS requests on its LAN IP, 10.32.0.1.  It limits requests from your LAN subnet.  Finally, it sets the cache size to 0.  This is good to start out with to make sure everything is working, but later you can bump it up to speed up multiple requests for the same sites. 







[su_box title=Opportunity Alert style=default box_color=#ffdddd title_color=#000000 radius=3 class= id=]
This is another opportunity to use the summary route that I've mentioned a few times.  

Instead of allowing 10.32.0.0/24, you would allow 10.32.0.0/16.  This would ensure that as you add VLANs and subnets, your DNS will just work without adding a long list of /24s. 
[/su_box]















DNS Forwarding



There is one more consideration to be made.  As configured, your DNS server will run in recursor mode.  This means it will take responsibility for fully resolving DNS on its own.  This may be a bad thing for a number of reasons:



It leaks your IP to potential undesirables.  It's almost always slower, as you don't get to benefit from the caches of a large service like CloudFlare or Google.  



It's quite simple to set up in forwarding mode, meaning when you make a DNS request, you end up asking an upstream resolver.  



In the following example, we'll be using CloudFlare and Google:



set service dns forwarding name-server 1.1.1.1
set service dns forwarding name-server 1.0.0.1
set service dns forwarding name-server 8.8.8.8
set service dns forwarding name-server 8.8.4.4
commit
save











System DNS



One final step is to set the DNS for VyOS itself.  Everything we've done so far has just set up VyOS to be a DNS server for your clients.



This will be the DNS that is used, for example, when you do a VyOS update, ping or traceroute from VyOS, etc.



The easiest thing to do if you've been following this guide, is just to use the DNS server you set up above:



set system name-server 10.32.0.1
commit
save



This is also another spot where if you wanted to use Google, CloudFlare, or AD-DNS, you could plug in that IP:







Alternatively, you call tell VyOS to use the DNS servers that it received from your WAN DHCP server with:



set system name-servers-dhcp eth0











Firewall



If you've made it this far, congrats!  We are almost there! 



This section will cover the creation of a zone-based firewall, which is far superior to the default method of attaching firewalls to interfaces.  



The reason it is superior is simple.  It's a bit more hassle to set up, but it's far easier to manage on an ongoing basis, plus, you start thinking about firewalling as flows of information from interface to interface.







Goals:



Enter configuration modeCreate a firewall to allow all LAN traffic.Create firewall to allow all LAN traffic to access VyOS itself.Create a firewall to protect the router itself from WAN.Create a firewall to protect LAN devices from WAN.CommitCreate LOCAL/LAN zones.Assign appropriate interfaces to zones.Commit and save







For as complex as firewalling seems, it's actually pretty simple when you break it down.  



A firewall tracks connection states to determine what is and is not allowed.  This is where packets are originating and going to, ports involved, types of traffic like TCP/UDP/ICMP, and more.  



We are going to build a very simple firewall that assumes that we want to block everything externally, and allow everything from LAN.



So let's dig right into it.







LAN



First, create a firewall that will allow our LAN to access everything. This is a setup that would mimic what most consumer routers do:



conf
set firewall name LAN-WAN default-action accept
set firewall name LAN-LOCAL default-action accept
commit
save



The LAN-WAN and the LAN-LOCAL can be arbitrarily named anything.  I use this naming scheme because as mentioned above, it's better to think about firewalls as controlling the flow of information through the router, and these names are self-documenting.



LOCAL is a specific VyOS designation that means this router.  When you are attaching the firewall in the zones, LOCAL will be what you use to control traffic destined to the firewall itself.  



As should be obvious, we are just allowing everything.  But you can set whatever rules you wanted.  LAN-WAN would generally remain pretty open as it would be uncommon to block your own access to the Internet, but LAN-LOCAL might contain rules to maybe allow only specific devices access to manage the VyOS router.



Also note that we are just creating the firewalls here.  They don't become active until you attach them to the zones.











LOCAL



As mentioned, the LOCAL zone is traffic destined for the VyOS router itself.  



In most cases, it will have a similar ruleset to the LAN one above, as most people want their router to have full access to the Internet and their LAN devices:



conf
set firewall name LOCAL-WAN default-action accept
set firewall name LOCAL-LAN default-action accept
commit
save



[su_box title=Food for Thought style=default box_color=#ddffdd title_color=#000000 radius=3 class= id=]

While I might be getting a little ahead of myself here, it's important to note that you could use the same firewall instead of creating four different firewalls as we've done here.  The firewalls are just attached to interfaces or zones by names, so there's nothing really stopping you from creating a single firewall and attaching it to four different places.

As a bit of a pro-tip though, I would recommend not doing this.  Eventually you'll want them broken out, and it's far more of a hassle to do it later than to just do it during initial setup.
[/su_box]











WAN



The WAN zone is where we are actually going to do most of our work.  



The basic goal here will be two things.  To block all access to the router itself, and to provide basic setup and template for future things like port forwarding to our LAN.  



When you start moving data to and from the Internet, that's when you need to start worrying about the state tracking I mentioned before.  



For both LOCAL and LAN traffic, we'll be setting up what's known as a stateful firewall.  



In stateful firewalling, there are three main states to worry about:



New - Traffic in a NEW state is the first packet from a destination to a source.  Allowing or denying this packet ultimately determines whether the traffic will be allowed.Established - Once traffic from NEW has been allowed, the subsequent packets are marked as ESTABLISHED.  This is essentially traffic that has already been allowed by other rules.  This is another basic requirement for a working stateful firewall.Related - This means that this is traffic that is somehow related to already allowed traffic.  Also required.



[su_box title=A note about rule numbers style=default box_color=#ddffdd title_color=#000000 radius=3 class= id=]
As with the NAT rule numbers, the rule numbers you use for firewall are arbitrary.

With that said, it doesn't mean you shouldn't plan ahead a bit:

 	Rules are processed numerically, so for fastest firewalling and routing, you definitely want your ESTABLISHED/RELATED rule at the top.  That ensures that existing traffic, which is going to be the bulk of the traffic your firewall processes, only has to look at a single rule.
 	Leave yourself some gaps for future rules.  You'll appreciate it later if you want to insert a new rule before an existing one, though you can always rename and move around.
[/su_box]







WAN-LOCAL



As mentioned, the WAN-LOCAL firewall is traffic destined for the VyOS router itself.  In the future, this will be where you allow traffic, say to your WireGuard port for VPN.



The first rule we want to build is to allow all ESTABLISHED and RELATED traffic.  So we'll:



Create the WAN-LOCAL firewall.  Set the default policy on the firewall to drop everything.  Create a rule to accept specific traffic for rule.Set the match for the rule to our established and related states.Set a description for ease of use later.







set firewall name WAN-LOCAL default-action drop
set firewall name WAN-LOCAL rule 5 action accept
set firewall name WAN-LOCAL rule 5 state established enable
set firewall name WAN-LOCAL rule 5 state related enable
set firewall name WAN-LOCAL rule 5 description Allow EST/Related Traffic
commit
save











The next rule we want on is to allow ICMP.  Many people like to block this, but not me.  I'll defer to ShouldIBlockICMP.com on this.



Create a new rule matching ICMPMatch the state of NEW. This is what actually matches the unknown traffic to allowAllow the trafficCommit and save



set firewall name WAN-LOCAL rule 20 protocol icmp
set firewall name WAN-LOCAL rule 20 state new enable
set firewall name WAN-LOCAL rule 20 action accept
commit
save



And you can see that the firewall is created (but still not attached to any interfaces), by doing the op mode command show interfaces.







WAN-LAN



For now, the WAN-LAN firewall is identical to the WAN-LOCAL.  In the future, this is where you will allow your port forward rules, or other traffic you want to send to your LAN devices, so it's helpful to break it out beforehand.



As before, we create the firewall, set it to drop by default, allowed EST/RELATED, and allow ICMP, which won't do anything now, but could be helpful in the future:



set firewall name WAN-LAN default-action drop
set firewall name WAN-LAN rule 5 action accept
set firewall name WAN-LAN rule 5 state established enable
set firewall name WAN-LAN rule 5 state related enable
set firewall name WAN-LAN rule 5 description Allow EST/Related Traffic
set firewall name WAN-LAN rule 20 protocol icmp
set firewall name WAN-LAN rule 20 state new enable
set firewall name WAN-LAN rule 20 action accept



Don't forget you can dive down into levels as in the following example:











Finally!  We have our firewalls set up and ready to deploy.  







WAN and Zones



If you've been paying attention, we still don't have one VERY important piece to this puzzle. We still don't have WAN access!



Of course I did this to protect your router during the initial setup phase.  Until you have firewalls ready to deploy, you probably don't want to be kicking your brand new VyOS install out on the open Internet.  







Zones



Zones are easily one of my favorite parts of VyOS, and something that in my opinion, puts it lightyears ahead of other firewall solutions.



Especially as your firewalling needs grow, zones just make it so EASY.  As I sort of touched on, zones are a bit more work initially, but save you MUCH more time in the future.



[su_box title=Lockout Alert style=default box_color=#ffdddd title_color=#000000 radius=3 class= id=]
Be careful and pay attention here.  

If you mistype something and are still configuring VyOS over SSH, you can potentially lock yourself out.
[/su_box]



The naming scheme as I've outlined above should be helpful here when creating our firewall zones.  It basically says FROMZONE->TOZONE



So let's run through the whole thing.  



Goals:



Set the default action for the zone.  This should always be drop to cover yourself in case you miss something.Apply the For traffic from X zone to current zone, attach Y firewallAdd the interfaces that are part of this zoneRepeat for all zonescommitsave







So what does this look like for the LAN:



In this example we are working on the LAN zoneWe drop everything by defaultWe assign the WAN-LAN firewall to traffic from any interface in the below WAN zoneSimilarly for the LOCAL-LAN.  This is traffic from the VyOS instance itself to LAN hosts.We put eth1 in our LAN zone.



set zone-policy zone LAN default-action drop
set zone-policy zone LAN from WAN firewall name WAN-LAN
set zone-policy zone LAN from LOCAL firewall name LOCAL-LAN
set zone-policy zone LAN interface eth1










Repeat all steps for the LOCAL zone.  The major difference here is the local-zone designation.  As I've mentioned a few times, LOCAL is a special designation that means this firewall, so you don't attach interfaces:



set zone-policy zone LOCAL local-zone
set zone-policy zone LOCAL from LAN firewall name LAN-LOCAL
set zone-policy zone LOCAL from WAN firewall name WAN-LOCAL
set zone-policy zone LOCAL default-action drop








Finally, the WAN zone is basically the same as the LAN zone. The only major change you should notice is that I just changed the firewall names and interface name:



set zone-policy zone WAN from LAN firewall name LAN-WAN
set zone-policy zone WAN from LOCAL firewall name LOCAL-WAN
set zone-policy zone WAN interface eth0
set zone-policy zone WAN default-action drop











If you were like me, you might have tried committing between steps.  Unfortunately, if you don't set up everything at once, you'll quickly discover that zones are interdependent on one another.  This happens because I've created the LAN zone, but the referenced WAN and LOCAL zones don't exist yet.











Show your work



Hopefully, if you've done everything correctly, you should see all your zone policies set up under the op mode command run show zone-policy.  This view should make it obvious which traffic is flowing through what firewall:











WAN Setup



Finally, here we are.  



Setting up your WAN. If you've made it this far, congrats.  You are basically 1 or 2 commands away from having a working router and firewall!



There are multiple ways to get a WAN address.  For simplicity's sake, I'll just cover two of them here, static and DHCP assignment.  For something like PPPoE, you'll need a few more steps.



DHCP Assignment



DHCP is when your router asks your ISP's servers for what it should use for its IP address and routing information.  This is accomplished with one simple command (well, four if you add a description to the interface, and commit and save):



set interfaces ethernet eth0 address dhcp
set interfaces ethernet eth0 description WAN
commit
save



You can verify that the setup is complete with the op mode commands run show interfaces and run show ip route.  (I have some debug variables set, so ignore the extra output:







In the above output, 10.21.21.57 is the IP address I was assigned via DHCP.  The show ip route verifies that I have a default route.



[su_box title=Information Dump style=default box_color=#ddffdd title_color=#000000 radius=3 class= id=]
Your gateway or default route, is the router your devices ask when they encounter an IP address that they don't know how to get to.


In the networking world, this is represented by 0.0.0.0/0, which is a shortcut for the entire Internet

So in the above example, this VyOS knows how to talk directly to anything in the 10.21.21.0/24 or 10.32.0.0/24 subnets because they are directly connected.  Anything outside of that, it needs to ask 10.21.21.1 for a route to it.
[/su_box]



Static IP



Static IPs just skip the automatic configuration.  It's up to your ISP how this is configured, but usually it's an extra step, manually applying your default route.



So to duplicate my above DHCP configuration:



set interfaces ethernet eth0 address 10.21.21.57/24
set protocols static route 0.0.0.0/0 next-hop 10.21.21.1
commit
save



As you can see in the following screenshot, I forgot the exact format, so I hit my <TAB> button to get hints:







Check your work



Assuming nothing has gone wrong, you should be able to verify everything with the op mode command ping.  So let's hit Google with 4 pings:



run ping www.google.com count 4



If all goes well, you should see a response:











Conclusion



So wow, this post turned into a bit of a novel.  Hopefully if you've made it this far, your LAN clients now have accessible Internet. From a client, you should be able to ping google:











Obviously there are a lot of basic topics I haven't covered yet.  But I wanted to lay out and explain the basic setup first.  



Future editions will feature:



Port Forwarding.Hairpin NAT (this goes hand-in-hand with the first).VPNs, especially WireGuardHow routing works when you have VPNs.Some potential hardening tactics.Other advanced topics like BGP/OSPF.



Cheers!
" data-id="sfsi"><meta property="og:title" content="VyOS from Scratch – Edition 1" data-id="sfsi"><style type="text/css">img#wpstats{display:none}</style><meta name="theme-color" content="#3857F1"><link rel="icon" href="https://blog.kroy.io/wp-content/uploads/2020/04/cropped-android-chrome-512x512-3-32x32.png" sizes="32x32"><link rel="icon" href="https://blog.kroy.io/wp-content/uploads/2020/04/cropped-android-chrome-512x512-3-192x192.png" sizes="192x192"><link rel="apple-touch-icon" href="https://blog.kroy.io/wp-content/uploads/2020/04/cropped-android-chrome-512x512-3-180x180.png"><meta name="msapplication-TileImage" content="https://blog.kroy.io/wp-content/uploads/2020/04/cropped-android-chrome-512x512-3-270x270.png"></head><body class="archive tag tag-vyos tag-36 wp-embed-responsive sinatra-topbar__separators-regular sinatra-layout__fw-contained sinatra-with-dropdown-indicators sinatra-header-layout-1 sinatra-menu-animation-underline sinatra-header__separators-none si-blog-layout-1 si-page-title-align-left si-has-sidebar sinatra-sidebar-style-3 sinatra-sidebar-position__right-sidebar si-sidebar-r__after-content entry-media-hover-style-1 sinatra-copyright-layout-1 si-input-supported validate-comment-form si-menu-accessibility">


<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	
	<header id="masthead" class="site-header" role="banner" itemtype="https://schema.org/WPHeader" itemscope="itemscope"><div id="sinatra-header">
		<div id="sinatra-header-inner">
	
<div class="si-container si-header-container">

	
<div class="sinatra-logo si-header-element" itemtype="https://schema.org/Organization" itemscope="itemscope">
	<div class="logo-inner"><span class="site-title" itemprop="name">
						<a href="https://blog.kroy.io/" rel="home" itemprop="url">
							blog.kroy.io
						</a>
					</span><p class="site-description" itemprop="description">
						computers, tech, and whatever other random stuff crosses my mind.
					</p></div></div>

<nav class="site-navigation main-navigation sinatra-primary-nav sinatra-nav si-header-element" role="navigation" itemtype="https://schema.org/SiteNavigationElement" itemscope="itemscope" aria-label="Site Navigation"><ul class="sinatra-primary-nav"><li><a href="https://blog.kroy.io/"><span>Home</span></a></li></ul></nav><div class="si-header-widgets si-header-element sinatra-widget-location-right"><div class="si-header-widget__search si-header-widget sinatra-hide-mobile-tablet"><div class="si-widget-wrapper">
<div aria-haspopup="true">
	<a href="#" class="si-search">
		<i class="si-icon si-search"></i>
	</a>

	<div class="si-search-simple si-search-container dropdown-item">
		<form role="search" aria-label="Site Search" method="get" class="si-search-form" action="https://blog.kroy.io/">

			<label class="si-form-label">
				<span class="screen-reader-text">Search for:</span>
				<input type="search" class="si-input-search" placeholder="Search" value="" name="s" autocomplete="off"></label>

			
			<button type="submit" class="sinatra-animate-arrow right-arrow" aria-hidden="true" role="button">
				<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="30px" height="18px" viewbox="0 0 30 18" enable-background="new 0 0 30 18" xml:space="preserve"><path class="arrow-handle" d="M2.511,9.007l7.185-7.221c0.407-0.409,0.407-1.071,0-1.48s-1.068-0.409-1.476,0L0.306,8.259 c-0.408,0.41-0.408,1.072,0,1.481l7.914,7.952c0.407,0.408,1.068,0.408,1.476,0s0.407-1.07,0-1.479L2.511,9.007z"></path><path class="arrow-bar" fill-rule="evenodd" clip-rule="evenodd" d="M1,8h28.001c0.551,0,1,0.448,1,1c0,0.553-0.449,1-1,1H1c-0.553,0-1-0.447-1-1
					                            C0,8.448,0.447,8,1,8z"></path></svg></button>
		</form>
	</div>
</div>
</div></div></div>
	<span class="si-header-element si-mobile-nav">
				<button class="si-hamburger hamburger--spin si-hamburger-sinatra-primary-nav" aria-label="Menu" aria-controls="sinatra-primary-nav" type="button">

			
			<span class="hamburger-box">
				<span class="hamburger-inner"></span>
			</span>

		</button>
			</span>

</div>
	</div>
	</div>
		
<div class="page-header si-has-page-title si-has-breadcrumbs">
	<div class="si-container">

	
	
		<div class="si-page-header-wrapper">

			<div class="si-page-header-title">
				<h1 class="page-title" itemprop="headline">vyos</h1>			</div>

			
					</div>

	
	<div class="si-breadcrumbs"><nav role="navigation" aria-label="Breadcrumbs" class="breadcrumb-trail breadcrumbs" itemprop="breadcrumb"><ul class="trail-items" itemscope itemtype="http://schema.org/BreadcrumbList"><meta name="numberOfItems" content="2"><meta name="itemListOrder" content="Ascending"><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" class="trail-item trail-begin"><a href="https://blog.kroy.io/" rel="home" itemprop="item"><span itemprop="name">Home</span></a><meta itemprop="position" content="1"></li><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" class="trail-item trail-end"><span><span itemprop="name">vyos</span></span><meta itemprop="position" content="2"></li></ul></nav></div>
	</div>
</div>
	</header><div id="main" class="site-main">

		
<div class="si-container">

	<div id="primary" class="content-area">

		
		<main id="content" class="site-content" role="main" itemtype="http://schema.org/WebPageElement" itemprop="mainContentOfPage"><article id="post-593" class="sinatra-article post-593 post type-post status-publish format-standard has-post-thumbnail hentry category-routing category-vyos tag-vyos tag-vyosfromscratch" itemscope="" itemtype="https://schema.org/CreativeWork"><div class="si-blog-entry-content"><div class="post-thumb entry-media thumbnail"><a href="https://blog.kroy.io/2020/05/04/vyos-from-scratch-edition-1/" class="entry-image-link"><img width="336" height="135" src="https://blog.kroy.io/wp-content/uploads/2020/04/image-5.png" class="attachment-large size-large wp-post-image" alt="VyOS from Scratch – Edition 1" loading="lazy"></a></div>
<header class="entry-header"><h2 class="entry-title" itemprop="headline">
		<a href="https://blog.kroy.io/2020/05/04/vyos-from-scratch-edition-1/" title="VyOS from Scratch – Edition 1" rel="bookmark">VyOS from Scratch – Edition 1</a>	</h2>

</header><div class="entry-meta"><div class="entry-meta-elements">		<span class="post-author">
			<span class="posted-by vcard author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person">
				<span class="screen-reader-text">Posted by</span>

				
				<span>
										By 					<a class="url fn n" title="View all posts by Kroy" href="https://blog.kroy.io/author/kroy3348/" rel="author" itemprop="url">
						<span class="author-name" itemprop="name">Kroy</span>
					</a>
				</span>
			</span>
		</span>
		<span class="posted-on">May 4, 2020</span><span class="cat-links"><span class="screen-reader-text">Posted in</span><span><a href="https://blog.kroy.io/category/routing/" rel="category tag">Routing</a>, <a href="https://blog.kroy.io/category/vyos/" rel="category tag">VyOS</a></span></span></div></div>
<div class="entry-summary si-entry" itemprop="text">

	As a VyOS evangelist, maintainer, and more, I've been meaning to write a simple series of "how-to" guides for VyOS for a while. Sure, there are plenty of guides out…
</div>

<footer class="entry-footer"><a href="https://blog.kroy.io/2020/05/04/vyos-from-scratch-edition-1/" class="si-btn btn-text-1"><span>Read More</span></a>
</footer></div>
</article></main></div>

	
<aside id="secondary" class="widget-area si-sidebar-container" itemtype="http://schema.org/WPSideBar" itemscope="itemscope" role="complementary"><div class="si-sidebar-inner">
		
		
		<div id="recent-posts-2" class="si-sidebar-widget si-widget si-entry widget widget_recent_entries">
		<h4 class="widget-title">Recent Posts</h4>
		<ul><li>
					<a href="https://blog.kroy.io/2020/11/03/esxi-to-libvirt-now-with-more-terraform/">ESXi to Libvirt, now with more Terraform.</a>
									</li>
											<li>
					<a href="https://blog.kroy.io/2020/05/04/vyos-from-scratch-edition-1/">VyOS from Scratch – Edition 1</a>
									</li>
											<li>
					<a href="https://blog.kroy.io/2020/01/17/the-baby-wyse-the-dell-3040/">A Baby WYSE, the 3040</a>
									</li>
											<li>
					<a href="https://blog.kroy.io/2019/12/08/the-wyse-5070-a-perfect-little-vyos-device/">The WYSE 5070, a perfect little VyOS device</a>
									</li>
											<li>
					<a href="https://blog.kroy.io/2019/11/21/battle-of-the-bare-metal-routers/">Battle of the Bare Metal Routers</a>
									</li>
					</ul></div><div id="archives-2" class="si-sidebar-widget si-widget si-entry widget widget_archive"><h4 class="widget-title">Archives</h4>
			<ul><li><a href="https://blog.kroy.io/2020/11/">November 2020</a></li>
	<li><a href="https://blog.kroy.io/2020/05/">May 2020</a></li>
	<li><a href="https://blog.kroy.io/2020/01/">January 2020</a></li>
	<li><a href="https://blog.kroy.io/2019/12/">December 2019</a></li>
	<li><a href="https://blog.kroy.io/2019/11/">November 2019</a></li>
	<li><a href="https://blog.kroy.io/2019/10/">October 2019</a></li>
	<li><a href="https://blog.kroy.io/2019/09/">September 2019</a></li>
	<li><a href="https://blog.kroy.io/2019/08/">August 2019</a></li>
	<li><a href="https://blog.kroy.io/2019/01/">January 2019</a></li>
	<li><a href="https://blog.kroy.io/2018/11/">November 2018</a></li>
	<li><a href="https://blog.kroy.io/2018/07/">July 2018</a></li>
	<li><a href="https://blog.kroy.io/2018/05/">May 2018</a></li>
	<li><a href="https://blog.kroy.io/2017/12/">December 2017</a></li>
	<li><a href="https://blog.kroy.io/2017/08/">August 2017</a></li>
	<li><a href="https://blog.kroy.io/2017/07/">July 2017</a></li>
	<li><a href="https://blog.kroy.io/2017/06/">June 2017</a></li>
	<li><a href="https://blog.kroy.io/2017/05/">May 2017</a></li>
	<li><a href="https://blog.kroy.io/2017/04/">April 2017</a></li>
	<li><a href="https://blog.kroy.io/2017/03/">March 2017</a></li>
	<li><a href="https://blog.kroy.io/2017/02/">February 2017</a></li>
	<li><a href="https://blog.kroy.io/2017/01/">January 2017</a></li>
			</ul></div><div id="categories-2" class="si-sidebar-widget si-widget si-entry widget widget_categories"><h4 class="widget-title">Categories</h4>
			<ul><li class="cat-item cat-item-39"><a href="https://blog.kroy.io/category/automation/">Automation</a>
</li>
	<li class="cat-item cat-item-12"><a href="https://blog.kroy.io/category/ceph/">ceph</a>
</li>
	<li class="cat-item cat-item-19"><a href="https://blog.kroy.io/category/debian/">Debian</a>
</li>
	<li class="cat-item cat-item-22"><a href="https://blog.kroy.io/category/docker/">Docker</a>
</li>
	<li class="cat-item cat-item-24"><a href="https://blog.kroy.io/category/virtualization/esxi/">ESXi</a>
</li>
	<li class="cat-item cat-item-7"><a href="https://blog.kroy.io/category/freenas/">freenas</a>
</li>
	<li class="cat-item cat-item-26"><a href="https://blog.kroy.io/category/hardware/">Hardware</a>
</li>
	<li class="cat-item cat-item-29"><a href="https://blog.kroy.io/category/hardware-hacks/">Hardware Hacks</a>
</li>
	<li class="cat-item cat-item-4"><a href="https://blog.kroy.io/category/homelab/">HomeLab</a>
</li>
	<li class="cat-item cat-item-38"><a href="https://blog.kroy.io/category/virtualization/kvm/">KVM</a>
</li>
	<li class="cat-item cat-item-2"><a href="https://blog.kroy.io/category/mediaserver/">mediaserver</a>
</li>
	<li class="cat-item cat-item-15"><a href="https://blog.kroy.io/category/mikrotik/">mikrotik</a>
</li>
	<li class="cat-item cat-item-20"><a href="https://blog.kroy.io/category/networking/">Networking</a>
</li>
	<li class="cat-item cat-item-8"><a href="https://blog.kroy.io/category/nucnucnuc/">nucnucnuc</a>
</li>
	<li class="cat-item cat-item-9"><a href="https://blog.kroy.io/category/pfsense/">pfsense</a>
</li>
	<li class="cat-item cat-item-11"><a href="https://blog.kroy.io/category/proxmox/">proxmox</a>
</li>
	<li class="cat-item cat-item-25"><a href="https://blog.kroy.io/category/virtualization/proxmox-virtualization/">Proxmox</a>
</li>
	<li class="cat-item cat-item-13"><a href="https://blog.kroy.io/category/qnap/">QNAP</a>
</li>
	<li class="cat-item cat-item-31"><a href="https://blog.kroy.io/category/homelab/rack-migration/">Rack Migration</a>
</li>
	<li class="cat-item cat-item-14"><a href="https://blog.kroy.io/category/routeros/">RouterOS</a>
</li>
	<li class="cat-item cat-item-18"><a href="https://blog.kroy.io/category/routing/" title="Stuff about routing">Routing</a>
</li>
	<li class="cat-item cat-item-21"><a href="https://blog.kroy.io/category/rtlsdr/">RTLSDR</a>
</li>
	<li class="cat-item cat-item-30"><a href="https://blog.kroy.io/category/storage/">Storage</a>
</li>
	<li class="cat-item cat-item-3"><a href="https://blog.kroy.io/category/sysadmin/">SysAdmin</a>
</li>
	<li class="cat-item cat-item-40"><a href="https://blog.kroy.io/category/automation/terraform/">Terraform</a>
</li>
	<li class="cat-item cat-item-46"><a href="https://blog.kroy.io/category/ubuntu/">Ubuntu</a>
</li>
	<li class="cat-item cat-item-23"><a href="https://blog.kroy.io/category/virtualization/">Virtualization</a>
</li>
	<li class="cat-item cat-item-16"><a href="https://blog.kroy.io/category/vyos/">VyOS</a>
</li>
	<li class="cat-item cat-item-5"><a href="https://blog.kroy.io/category/zfs/">ZFS</a>
</li>
			</ul></div><div id="meta-2" class="si-sidebar-widget si-widget si-entry widget widget_meta"><h4 class="widget-title">Meta</h4>
		<ul><li><a href="https://blog.kroy.io/wp-login.php">Log in</a></li>
			<li><a href="https://blog.kroy.io/feed/">Entries feed</a></li>
			<li><a href="https://blog.kroy.io/comments/feed/">Comments feed</a></li>

			<li><a href="https://wordpress.org/">WordPress.org</a></li>
		</ul></div><div id="custom_html-2" class="widget_text si-sidebar-widget si-widget si-entry widget widget_custom_html"><div class="textwidget custom-html-widget"><div id="amzn-assoc-ad-96eac8be-1743-4b44-98e2-f274484e1cac"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=96eac8be-1743-4b44-98e2-f274484e1cac"></script></div></div>
			</div>

</aside></div>

		
	</div>
	
	
			<footer id="colophon" class="site-footer" role="contentinfo" itemtype="http://schema.org/WPFooter" itemscope="itemscope"><div id="sinatra-copyright" class="contained-separator">
	<div class="si-container">
		<div class="si-flex-row">

			<div class="col-xs-12 center-xs col-md flex-basis-auto start-md"><div class="si-copyright-widget__text si-copyright-widget sinatra-all"><span>Copyright 2020 — blog.kroy.io. All rights reserved. <a href="https://wordpress.org/themes/sinatra/" class="imprint" target="_blank" rel="noopener noreferrer">Sinatra WordPress Theme</a></span></div></div>
			<div class="col-xs-12 center-xs col-md flex-basis-auto end-md"></div>

		</div>
	</div>
</div>

		</footer></div>

<a href="#" id="si-scroll-top" class="si-smooth-scroll" title="Scroll to Top">
	<span class="si-scroll-icon" aria-hidden="true">
		<i class="si-icon si-chevron-up top-icon"></i>
		<i class="si-icon si-chevron-up"></i>
	</span>
	<span class="screen-reader-text">Scroll to Top</span>
</a>
			
			<div id="fb-root"></div>
			<script>
				(function(d, s, id) {
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) return;
					js = d.createElement(s);
					js.id = id;
					js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
					fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));
			</script><script>
window.addEventListener('sfsi_functions_loaded', function() {
    if (typeof sfsi_responsive_toggle == 'function') {
        sfsi_responsive_toggle(0);
        // console.log('sfsi_responsive_toggle');

    }
})
</script><style type="text/css">#sfsi_floater { margin-right:0px; }</style><div class="norm_row sfsi_wDiv" id="sfsi_floater" style="z-index: 9999;width:225px;text-align:left;position:absolute;position:absolute;right:30px;top:50%"><div style="width:40px; height:40px;margin-left:5px;margin-bottom:5px; " class="sfsi_wicons shuffeldiv "><div class="inerCnt"><a class=" sficn" data-effect="" target="_blank" href="https://blog.kroy.io/feed/" id="sfsiid_rss" style="opacity:1"><img data-pin-nopin="true" alt="RSS" title="RSS" src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/images/icons_theme/default/default_rss.png" width="40" height="40" style="" class="sfcm sfsi_wicon " data-effect=""></a></div></div><div style="width:40px; height:40px;margin-left:5px;margin-bottom:5px; " class="sfsi_wicons shuffeldiv "><div class="inerCnt"><a class=" sficn" data-effect="" target="_blank" href="https://api.follow.it/widgets/icon/SERxZVdXbkRiWE9LYThHK2pmY09ydUlMSkF3cm9ERmJpV2JlS3p0Z1locmlNWjBFeGZtaFBCMEF4Q1hRblVqN0JUbGFXRXg4Y25yUnpVcFN0TUVQeTdIVUtkT1JVRXg2SXJvYndWbEJhRi9ZenJWdk1XSlc1VWQwQVIvNVY3dWJ8YnBDU2RZbGZvSzFjVlBLVDRjWGYwellwelNqT2ZCQzFzbmp6V24vN0FQOD0=/OA==/" id="sfsiid_email" style="opacity:1"><img data-pin-nopin="true" alt="Follow by Email" title="Follow by Email" src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/images/icons_theme/default/default_email.png" width="40" height="40" style="" class="sfcm sfsi_wicon " data-effect=""></a></div></div><div style="width:40px; height:40px;margin-left:5px;margin-bottom:5px; " class="sfsi_wicons shuffeldiv "><div class="inerCnt"><a class=" sficn" data-effect="" target="_blank" href="" id="sfsiid_facebook" style="opacity:1"><img data-pin-nopin="true" alt="Facebook" title="Facebook" src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/images/icons_theme/default/default_facebook.png" width="40" height="40" style="" class="sfcm sfsi_wicon " data-effect=""></a><div class="sfsi_tool_tip_2 fb_tool_bdr sfsiTlleft" style="width:62px ;opacity:0;z-index:-1;margin-left:-47.5px;" id="sfsiid_facebook"><span class="bot_arow bot_fb_arow"></span><div class="sfsi_inside"><div class="icon2"><div class="fb-like" data-href="https://blog.kroy.io/tag/vyos" data-layout="button" data-action="like" data-show-faces="false" data-share="true"></div></div><div class="icon3"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.kroy.io%2Ftag%2Fvyos" style="display:inline-block;"> <img class="sfsi_wicon" data-pin-nopin="true" width="auto" height="auto" alt="fb-share-icon" title="Facebook Share" src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/images/visit_icons/fbshare_bck.png"></a></div></div></div></div></div><div style="width:40px; height:40px;margin-left:5px;margin-bottom:5px; " class="sfsi_wicons shuffeldiv "><div class="inerCnt"><a class=" sficn" data-effect="" target="_blank" href="" id="sfsiid_twitter" style="opacity:1"><img data-pin-nopin="true" alt="Twitter" title="Twitter" src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/images/icons_theme/default/default_twitter.png" width="40" height="40" style="" class="sfcm sfsi_wicon " data-effect=""></a><div class="sfsi_tool_tip_2 twt_tool_bdr sfsiTlleft" style="width:59px ;opacity:0;z-index:-1;margin-left:-46px;" id="sfsiid_twitter"><span class="bot_arow bot_twt_arow"></span><div class="sfsi_inside"><div class="icon2"><div class="sf_twiter" style="display: inline-block;vertical-align: middle;width: auto;">
						<a target="_blank" href="https://twitter.com/intent/tweet?text=Hey%2C+check+out+this+cool+site+I+found%3A+www.yourname.com+%23Topic+via%40my_twitter_name+https://blog.kroy.io/tag/vyos" style="display:inline-block">
							<img data-pin-nopin="true" width="auto" class="sfsi_wicon" src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/images/visit_icons/en_US_Tweet.svg" alt="Tweet" title="Tweet"></a>
					</div></div></div></div></div></div><div style="width:40px; height:40px;margin-left:5px;margin-bottom:5px; " class="sfsi_wicons shuffeldiv "><div class="inerCnt"><a class=" sficn" data-effect="" target="_blank" href="" id="sfsiid_linkedin" style="opacity:1"><img data-pin-nopin="true" alt="LinkedIn" title="LinkedIn" src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/images/icons_theme/default/default_linkedin.png" width="40" height="40" style="" class="sfcm sfsi_wicon " data-effect=""></a><div class="sfsi_tool_tip_2 linkedin_tool_bdr sfsiTlleft" style="width:85px ;opacity:0;z-index:-1;margin-left:-45px;" id="sfsiid_linkedin"><span class="bot_arow bot_linkedin_arow"></span><div class="sfsi_inside"><div class="icon2"><a target="_blank" href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.kroy.io%2Ftag%2Fvyos"><img class="sfsi_wicon" data-pin-nopin="true" alt="Share" title="Share" src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/images/visit_icons/lnkdin_share_bck.png"></a></div></div></div></div></div></div><input type="hidden" id="sfsi_floater_sec" value="center-right"><script>window.addEventListener("sfsi_functions_loaded", function() 
			{
				if (typeof sfsi_widget_set == "function") {
					sfsi_widget_set();
				}
			}); window.addEventListener('sfsi_functions_loaded',function()
					  {
						var topalign = ( jQuery(window).height() - jQuery('#sfsi_floater').height() ) / 2;
						jQuery('#sfsi_floater').css('top',topalign);
					  	sfsi_float_widget('center');
					  });</script><script>
        window.addEventListener('sfsi_functions_loaded', function() {
            if (typeof sfsi_plugin_version == 'function') {
                sfsi_plugin_version(2.60);
            }
        });

        function sfsi_processfurther(ref) {
            var feed_id = 'SERxZVdXbkRiWE9LYThHK2pmY09ydUlMSkF3cm9ERmJpV2JlS3p0Z1locmlNWjBFeGZtaFBCMEF4Q1hRblVqN0JUbGFXRXg4Y25yUnpVcFN0TUVQeTdIVUtkT1JVRXg2SXJvYndWbEJhRi9ZenJWdk1XSlc1VWQwQVIvNVY3dWJ8YnBDU2RZbGZvSzFjVlBLVDRjWGYwellwelNqT2ZCQzFzbmp6V24vN0FQOD0=';
            var feedtype = 8;
            var email = jQuery(ref).find('input[name="email"]').val();
            var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            if ((email != "Enter your email") && (filter.test(email))) {
                if (feedtype == "8") {
                    var url = "https://api.follow.it/subscription-form/" + feed_id + "/" + feedtype;
                    window.open(url, "popupwindow", "scrollbars=yes,width=1080,height=760");
                    return true;
                }
            } else {
                alert("Please enter email address");
                jQuery(ref).find('input[name="email"]').focus();
                return false;
            }
        }
    </script><style type="text/css" aria-selected="true">
        .sfsi_subscribe_Popinner {
            width: 100% !important;

            height: auto !important;

            padding: 18px 0px !important;

            background-color: #ffffff !important;

        }

        .sfsi_subscribe_Popinner form {

            margin: 0 20px !important;

        }

        .sfsi_subscribe_Popinner h5 {

            font-family: Helvetica,Arial,sans-serif !important;

            font-weight: bold !important;

            color: #000000 !important;

            font-size: 16px !important;

            text-align: center !important;

            margin: 0 0 10px !important;

            padding: 0 !important;

        }

        .sfsi_subscription_form_field {

            margin: 5px 0 !important;

            width: 100% !important;

            display: inline-flex;

            display: -webkit-inline-flex;

        }

        .sfsi_subscription_form_field input {

            width: 100% !important;

            padding: 10px 0px !important;

        }

        .sfsi_subscribe_Popinner input[type=email] {

            font-family: Helvetica,Arial,sans-serif !important;

            font-style: normal !important;

            color: #000000 !important;

            font-size: 14px !important;

            text-align: center !important;

        }

        .sfsi_subscribe_Popinner input[type=email]::-webkit-input-placeholder {

            font-family: Helvetica,Arial,sans-serif !important;

            font-style: normal !important;

            color: #000000 !important;

            font-size: 14px !important;

            text-align: center !important;

        }

        .sfsi_subscribe_Popinner input[type=email]:-moz-placeholder {
            /* Firefox 18- */

            font-family: Helvetica,Arial,sans-serif !important;

            font-style: normal !important;

            color: #000000 !important;

            font-size: 14px !important;

            text-align: center !important;

        }

        .sfsi_subscribe_Popinner input[type=email]::-moz-placeholder {
            /* Firefox 19+ */

            font-family: Helvetica,Arial,sans-serif !important;

            font-style: normal !important;

            color: #000000 !important;

            font-size: 14px !important;

            text-align: center !important;

        }

        .sfsi_subscribe_Popinner input[type=email]:-ms-input-placeholder {

            font-family: Helvetica,Arial,sans-serif !important;

            font-style: normal !important;

            color: #000000 !important;

            font-size: 14px !important;

            text-align: center !important;

        }

        .sfsi_subscribe_Popinner input[type=submit] {

            font-family: Helvetica,Arial,sans-serif !important;

            font-weight: bold !important;

            color: #000000 !important;

            font-size: 16px !important;

            text-align: center !important;

            background-color: #dedede !important;

        }

        .sfsi_shortcode_container {
            float: left;
        }

        .sfsi_shortcode_container .norm_row .sfsi_wDiv {
            position: relative !important;
        }

        .sfsi_shortcode_container .sfsi_holders {
            display: none;
        }

            </style><script src="https://blog.kroy.io/wp-includes/js/jquery/ui/core.min.js" id="jquery-ui-core-js"></script><script src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/js/shuffle/modernizr.custom.min.js" id="SFSIjqueryModernizr-js"></script><script src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/js/shuffle/jquery.shuffle.min.js" id="SFSIjqueryShuffle-js"></script><script src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/js/shuffle/random-shuffle-min.js" id="SFSIjqueryrandom-shuffle-js"></script><script id="SFSICustomJs-js-extra">
var sfsi_icon_ajax_object = {"ajax_url":"https:\/\/blog.kroy.io\/wp-admin\/admin-ajax.php"};
var sfsi_icon_ajax_object = {"ajax_url":"https:\/\/blog.kroy.io\/wp-admin\/admin-ajax.php","plugin_url":"https:\/\/blog.kroy.io\/wp-content\/plugins\/ultimate-social-media-icons\/"};
</script><script src="https://blog.kroy.io/wp-content/plugins/ultimate-social-media-icons/js/custom.js" id="SFSICustomJs-js"></script><script src="https://blog.kroy.io/wp-content/plugins/wplegalpages/admin/js/jquery.cookie.min.js" id="wp-legal-pages-jquery-cookie-js"></script><script id="sinatra-js-js-extra">
var sinatra_vars = {"ajaxurl":"https:\/\/blog.kroy.io\/wp-admin\/admin-ajax.php","nonce":"00b8b3d7c4","responsive-breakpoint":"960","sticky-header":"","strings":{"comments_toggle_show":"Leave a Comment","comments_toggle_hide":"Hide Comments"}};
</script><script src="https://blog.kroy.io/wp-content/themes/sinatra/assets/js/sinatra.min.js" id="sinatra-js-js"></script><script>
	!function(){var e=-1<navigator.userAgent.toLowerCase().indexOf("webkit"),t=-1<navigator.userAgent.toLowerCase().indexOf("opera"),n=-1<navigator.userAgent.toLowerCase().indexOf("msie");(e||t||n)&&document.getElementById&&window.addEventListener&&window.addEventListener("hashchange",function(){var e,t=location.hash.substring(1);/^[A-z0-9_-]+$/.test(t)&&(e=document.getElementById(t))&&(/^(?:a|select|input|button|textarea)$/i.test(e.tagName)||(e.tabIndex=-1),e.focus())},!1)}();
	</script><script type="text/javascript" src="https://stats.wp.com/e-202045.js" async="async" defer></script><script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:9.0.2',blog:'166765678',post:'0',tz:'-6',srv:'blog.kroy.io'} ]);
	_stq.push([ 'clickTrackerInit', '166765678', '0' ]);
</script><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><symbol id="icon-chat" viewbox="0 0 576 512"><path d="M512 160h-96V64c0-35.3-28.7-64-64-64H64C28.7 0 0 28.7 0 64v160c0 35.3 28.7 64 64 64h32v52c0 7.1 5.8 12 12 12 2.4 0 4.9-.7 7.1-2.4L224 288h128c35.3 0 64-28.7 64-64v-32h96c17.6 0 32 14.4 32 32v160c0 17.6-14.4 32-32 32h-64v49.6l-80.2-45.4-7.3-4.2H256c-17.6 0-32-14.4-32-32v-96l-32 18.1V384c0 35.3 28.7 64 64 64h96l108.9 61.6c2.2 1.6 4.7 2.4 7.1 2.4 6.2 0 12-4.9 12-12v-52h32c35.3 0 64-28.7 64-64V224c0-35.3-28.7-64-64-64zm-128 64c0 17.6-14.4 32-32 32H215.6l-7.3 4.2-80.3 45.4V256H64c-17.6 0-32-14.4-32-32V64c0-17.6 14.4-32 32-32h288c17.6 0 32 14.4 32 32v160z"></path></symbol><symbol id="icon-quote" viewbox="0 0 123.961 123.961"><path d="M49.8 29.032c3.1-1.3 4.4-5 3-8l-4.9-10.3c-1.4-2.899-4.8-4.2-7.8-2.899-8.5 3.6-15.8 8.3-21.6 14C11.4 28.532 6.6 36.232 4 44.732c-2.6 8.601-4 20.3-4 35.2v30.7c0 3.3 2.7 6 6 6h39.3c3.3 0 6-2.7 6-6v-39.3c0-3.301-2.7-6-6-6H26.5c.2-10.101 2.6-18.2 7-24.301 3.6-4.898 9-8.898 16.3-11.999zM120.4 29.032c3.1-1.3 4.399-5 3-8l-4.9-10.199c-1.4-2.9-4.8-4.2-7.8-2.9-8.4 3.6-15.601 8.3-21.5 13.9-7.101 6.8-12 14.5-14.601 23-2.6 8.399-3.899 20.1-3.899 35.1v30.7c0 3.3 2.7 6 6 6H116c3.3 0 6-2.7 6-6v-39.3c0-3.301-2.7-6-6-6H97.1c.2-10.101 2.601-18.2 7-24.301 3.6-4.899 9-8.899 16.3-12z"></path></symbol></svg><div class="wpautoterms-footer"><p>
		<a href="https://blog.kroy.io/wpautoterms/privacy-policy/">Privacy Policy</a><span class="separator"> - </span><a href="https://blog.kroy.io/wpautoterms/terms-and-conditions/">Terms and Conditions</a></p>
</div>
</body></html>
